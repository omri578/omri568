<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>לוח תוצאות</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b5b2a">

  <style>
    body{margin:0;font-family:Arial;background:#000}
    .app{
      min-height:100vh;
      background:url("assets/pitch.png") center/cover no-repeat;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .overlay{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    .content{position:relative;z-index:2;width:100%;max-width:900px}

    h1{color:#fff;text-align:center;margin-bottom:16px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}

    .team{
      width:30%;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      cursor:pointer;
    }

    .logo{
      width:100px;height:100px;
      border-radius:18px;
      overflow:hidden;
      border:3px solid #fff;
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    .name{color:#fff;font-weight:800;text-align:center}

    .scorebox{
      background:rgba(0,0,0,.7);
      border-radius:18px;
      padding:14px 20px;
      display:flex;
      align-items:center;
      gap:16px;
    }

    .score{
      color:#fff;
      font-size:52px;
      font-weight:900;
      cursor:pointer;
      user-select:none;
    }

    .dash{color:#fff;font-size:36px;font-weight:700}

    .buttons{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top:16px;
      flex-wrap:wrap;
    }

    button{
      padding:10px 16px;
      border:none;
      border-radius:12px;
      font-weight:800;
      cursor:pointer;
    }

    .btn-reset{background:#fff}
    .btn-undo{background:#ffd54a}
    .btn-var{background:#ff7676}
    .btn-half{background:#7ad1ff}
    .btn-lineup{background:#b6ff7a}

    .varStatus{
      color:#fff;
      text-align:center;
      margin-top:12px;
      font-weight:900;
      background:rgba(0,0,0,.6);
      padding:8px 12px;
      border-radius:12px;
    }

    dialog{
      border:none;
      border-radius:16px;
      padding:14px;
      max-width:700px;
      width:92%;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
      margin-top:10px;
    }

    .pick{
      border:2px solid #ddd;
      border-radius:14px;
      padding:8px;
      cursor:pointer;
      text-align:center;
      background:#fff;
    }

    .pick img{
      width:70px;height:70px;
      border-radius:14px;
      object-fit:cover;
    }

    /* ✅ זום למחצית */
    .zoomHalf{ animation:halfZoom 1.8s ease; transform-origin:center; }
    @keyframes halfZoom{
      0%{transform:scale(1)}
      40%{transform:scale(1.35)}
      70%{transform:scale(1.25)}
      100%{transform:scale(1)}
    }

    /* ====== מסך הרכבים ====== */
    .lineupTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .tag{
      background:#111;
      color:#fff;
      padding:8px 10px;
      border-radius:10px;
      font-weight:900;
    }

    .formationRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .formationBtn{
      background:#fff;
      border:2px solid #222;
      border-radius:12px;
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
    }

    .editorWrap{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .miniPitch{
      width:360px;
      max-width:100%;
      aspect-ratio: 2 / 3;
      background:linear-gradient(#0b5b2a,#0a4d24);
      border-radius:18px;
      border:3px solid #fff;
      position:relative;
      overflow:hidden;
    }

    .miniPitch:before{
      content:"";
      position:absolute; inset:14px;
      border:2px solid rgba(255,255,255,.8);
      border-radius:14px;
    }

    .spot{
      position:absolute;
      transform:translate(-50%,-50%);
      min-width:90px;
      max-width:130px;
      background:rgba(0,0,0,.65);
      color:#fff;
      padding:6px 8px;
      border-radius:12px;
      border:2px solid rgba(255,255,255,.85);
      font-weight:900;
      text-align:center;
      font-size:12px;
      user-select:none;
      cursor:grab;
    }

    .bench{
      flex:1;
      min-width:240px;
      background:#f7f7f7;
      border-radius:16px;
      padding:10px;
      border:2px solid #ddd;
    }
    .benchTitle{font-weight:900;margin-bottom:8px}

    .player{
      display:inline-block;
      margin:6px;
      padding:8px 10px;
      background:#111;
      color:#fff;
      border-radius:12px;
      font-weight:900;
      cursor:grab;
      user-select:none;
      font-size:12px;
    }

    .hint{
      margin-top:8px;
      font-size:12px;
      color:#222;
      font-weight:700;
    }

    /* ✅ חובה לטאצ' */
    .player, .spot { touch-action: none; }

    .dragGhost{
      position:fixed;
      z-index:99999;
      pointer-events:none;
      background:#111;
      color:#fff;
      padding:10px 12px;
      border-radius:14px;
      font-weight:900;
      font-size:12px;
      transform:translate(-50%,-50%);
      opacity:.92;
      box-shadow:0 8px 24px rgba(0,0,0,.35);
    }
  </style>
</head>
<body>

<div class="app">
  <div class="overlay"></div>

  <div class="content" id="mainContent">
    <h1>לוח תוצאות</h1>

    <div class="row">
      <div class="team" onclick="openPicker('home')">
        <div class="logo"><img id="homeLogo" src="assets/team1.png"></div>
        <div class="name" id="homeName">קבוצה א׳</div>
      </div>

      <div class="scorebox">
        <div class="score" id="homeScore">0</div>
        <div class="dash">-</div>
        <div class="score" id="awayScore">0</div>
      </div>

      <div class="team" onclick="openPicker('away')">
        <div class="logo"><img id="awayLogo" src="assets/team2.png"></div>
        <div class="name" id="awayName">קבוצה ב׳</div>
      </div>
    </div>

    <div class="buttons">
      <button class="btn-reset" onclick="resetScore()">איפוס</button>
      <button class="btn-undo" onclick="undoGoal()">בטל גול</button>
      <button class="btn-var" onclick="runVAR()">VAR</button>
      <button class="btn-half" onclick="runHalf()">מחצית</button>

      <!-- יופיע רק כשמכבי תל אביב נבחרה בבית או בחוץ -->
      <button class="btn-lineup" id="maccabiLineupBtn" onclick="openMaccabiLineup()" style="display:none">
        הרכב מכבי
      </button>
    </div>

    <div class="varStatus" id="varStatus">VAR: אין בדיקה כרגע</div>
  </div>
</div>

<audio id="goalSound" src="assets/goal.mp3"></audio>
<audio id="whistleSound" src="assets/whistle.mp3"></audio>

<dialog id="picker">
  <h3 id="pickerTitle">בחר קבוצה</h3>
  <div class="grid" id="grid"></div>
  <div style="text-align:right;margin-top:10px">
    <button onclick="picker.close()">סגור</button>
  </div>
</dialog>

<!-- מסך הרכבים -->
<dialog id="lineupDialog">
  <div class="lineupTop">
    <div class="tag" id="lineupTeamTag">הרכב: מכבי תל אביב</div>
    <div class="tag" id="lineupSideTag">צד: בית</div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button onclick="resetLineup()">נקה עמדות</button>
      <button onclick="showFormationScreen()">החלף מערך</button>
      <button onclick="lineupDialog.close()">סגור</button>
    </div>
  </div>

  <div id="formationScreen">
    <div style="font-weight:900">בחר מערך:</div>
    <div class="formationRow">
      <button class="formationBtn" onclick="chooseFormation('4-3-3')">4-3-3</button>
      <button class="formationBtn" onclick="chooseFormation('4-4-2')">4-4-2</button>
      <button class="formationBtn" onclick="chooseFormation('4-2-3-1')">4-2-3-1</button>
      <button class="formationBtn" onclick="chooseFormation('3-5-2')">3-5-2</button>
    </div>
    <div class="hint">טאצ׳: לוחצים על שחקן/עמדה, גוררים ומשחררים.</div>
  </div>

  <div id="editorScreen" style="display:none">
    <div class="editorWrap">
      <div class="miniPitch" id="miniPitch"></div>

      <div class="bench">
        <div class="benchTitle">שחקנים (גרור למגרש)</div>
        <div id="benchPlayers"></div>
        <div class="hint">אפשר לגרור גם שחקן שכבר על המגרש לעמדה אחרת.</div>
      </div>
    </div>
  </div>
</dialog>

<script>
/* ================== קבוצות ================== */
const teams = [
  // ישראל
  {name:"מכבי תל אביב", logo:"assets/team1.png"},
  {name:"הפועל תל אביב", logo:"assets/team2.png"},
  {name:"מכבי חיפה", logo:"assets/team3.png"},
  {name:"בית״ר ירושלים", logo:"assets/team4.png"},
  {name:"הפועל באר שבע", logo:"assets/team5.png"},
  {name:"נתניה", logo:"assets/team6.png"},
  {name:"בני ריינה", logo:"assets/beni.png"},
  {name:"פתח תקווה", logo:"assets/pet.png"},
  {name:"מס אשדוד", logo:"assets/Ashdod.png"},
  {name:"הפועל פרדסיה", logo:"assets/par.jpg"},

  // אירופה
  {name:"ריאל מדריד", logo:"assets/real.png"},
  {name:"ברצלונה", logo:"assets/barcelona.png"},
  {name:"פריז סן ז'רמן", logo:"assets/psg.png"},
  {name:"מנצ'סטר סיטי", logo:"assets/mancity.png"},
  {name:"מנצ'סטר יונייטד", logo:"assets/manutd.png"},
  {name:"אינטר", logo:"assets/inter.png"},
  {name:"מונאקו", logo:"assets/monaco.png"},
  {name:"יובנטוס", logo:"assets/juve.png"},
  {name:"בייראן מינכן", logo:"assets/muc.png"},
  {name:"דורטמונד", logo:"assets/dort.png"}
];

/* ================== לוח תוצאות ================== */
const goalSound = document.getElementById("goalSound");
const whistleSound = document.getElementById("whistleSound");
const homeScore = document.getElementById("homeScore");
const awayScore = document.getElementById("awayScore");
const varStatus = document.getElementById("varStatus");
const mainContent = document.getElementById("mainContent");

const homeNameEl = document.getElementById("homeName");
const awayNameEl = document.getElementById("awayName");
const maccabiLineupBtn = document.getElementById("maccabiLineupBtn");

let lastGoal = null;

function playGoal(){
  try{ goalSound.currentTime = 0; goalSound.play(); }catch(e){}
}

homeScore.onclick = () => addGoal("home");
awayScore.onclick = () => addGoal("away");

function addGoal(side){
  if(side==="home") homeScore.textContent++;
  else awayScore.textContent++;
  lastGoal = side;
  varStatus.textContent = "VAR: אפשר לבדוק את הגול האחרון";
  playGoal();
}

function resetScore(){
  homeScore.textContent = 0;
  awayScore.textContent = 0;
  lastGoal = null;
  varStatus.textContent = "VAR: אין בדיקה כרגע";
}

function undoGoal(){
  if(lastGoal==="home" && Number(homeScore.textContent)>0) homeScore.textContent--;
  else if(lastGoal==="away" && Number(awayScore.textContent)>0) awayScore.textContent--;
  lastGoal = null;
  varStatus.textContent = "VAR: אין בדיקה כרגע";
}

function runVAR(){
  if(!lastGoal){
    varStatus.textContent = "VAR: אין גול לבדיקה";
    return;
  }

  const approved = Math.random() < 0.5;

  if(approved){
    varStatus.textContent = "VAR: ✅ הגול אושר!";
  } else {
    varStatus.textContent = "VAR: ❌ הגול נפסל!";
    if(lastGoal==="home" && Number(homeScore.textContent)>0) homeScore.textContent--;
    if(lastGoal==="away" && Number(awayScore.textContent)>0) awayScore.textContent--;
  }
  lastGoal = null;
}

function runHalf(){
  try{ whistleSound.currentTime = 0; whistleSound.play(); }catch(e){}
  mainContent.classList.remove("zoomHalf");
  void mainContent.offsetWidth;
  mainContent.classList.add("zoomHalf");
}

/* ================== Picker ================== */
const picker = document.getElementById("picker");
const grid = document.getElementById("grid");
let pickSide = "home";

function openPicker(side){
  pickSide = side;
  document.getElementById("pickerTitle").textContent =
    side==="home" ? "בחר קבוצה (בית)" : "בחר קבוצה (חוץ)";

  grid.innerHTML = "";
  teams.forEach(t=>{
    const d=document.createElement("div");
    d.className="pick";
    d.innerHTML=`<img src="${t.logo}"><div>${t.name}</div>`;
    d.onclick=()=>{
      document.getElementById(pickSide+"Logo").src=t.logo;
      document.getElementById(pickSide+"Name").textContent=t.name;
      picker.close();
      updateMaccabiButton();
    };
    grid.appendChild(d);
  });

  picker.showModal();
}

function updateMaccabiButton(){
  const home = homeNameEl.textContent.trim();
  const away = awayNameEl.textContent.trim();
  const isMaccabi = (home === "מכבי תל אביב") || (away === "מכבי תל אביב");
  maccabiLineupBtn.style.display = isMaccabi ? "inline-block" : "none";
}

/* ================== מסך הרכבים (טאצ' + עברית) ================== */
const lineupDialog = document.getElementById("lineupDialog");
const formationScreen = document.getElementById("formationScreen");
const editorScreen = document.getElementById("editorScreen");
const lineupSideTag = document.getElementById("lineupSideTag");
const miniPitch = document.getElementById("miniPitch");
const benchPlayers = document.getElementById("benchPlayers");

let maccabiSide = "home";
let currentFormation = null;

/* ✅ כאן תכתוב את השמות העדכניים שלך + עמדות בעברית
   (כרגע זו רשימה לדוגמה—תחליף לשמות שאתה רוצה) */
const maccabiPlayers = [
  {name:"שחקן 1", pos:"שוער"},
  {name:"שחקן 2", pos:"בלם"},
  {name:"שחקן 3", pos:"בלם"},
  {name:"שחקן 4", pos:"מגן ימני"},
  {name:"שחקן 5", pos:"מגן שמאלי"},
  {name:"שחקן 6", pos:"קשר אחורי"},
  {name:"שחקן 7", pos:"קשר מרכזי"},
  {name:"שחקן 8", pos:"קשר מרכזי"},
  {name:"שחקן 9", pos:"קיצוני ימין"},
  {name:"שחקן 10", pos:"קיצוני שמאל"},
  {name:"שחקן 11", pos:"חלוץ"}
];

/* ✅ מערכים עם תוויות בעברית */
const formations = {
  "4-3-3": [
    {x:50,y:88,label:"שוער"},
    {x:20,y:72,label:"מגן ימני"}, {x:40,y:74,label:"בלם"}, {x:60,y:74,label:"בלם"}, {x:80,y:72,label:"מגן שמאלי"},
    {x:30,y:55,label:"קשר מרכזי"}, {x:50,y:58,label:"קשר מרכזי"}, {x:70,y:55,label:"קשר מרכזי"},
    {x:22,y:32,label:"קיצוני ימין"}, {x:50,y:28,label:"חלוץ"}, {x:78,y:32,label:"קיצוני שמאל"}
  ],
  "4-4-2": [
    {x:50,y:88,label:"שוער"},
    {x:20,y:72,label:"מגן ימני"}, {x:40,y:74,label:"בלם"}, {x:60,y:74,label:"בלם"}, {x:80,y:72,label:"מגן שמאלי"},
    {x:20,y:52,label:"קשר ימין"}, {x:40,y:56,label:"קשר מרכזי"}, {x:60,y:56,label:"קשר מרכזי"}, {x:80,y:52,label:"קשר שמאל"},
    {x:42,y:28,label:"חלוץ"}, {x:58,y:28,label:"חלוץ"}
  ],
  "4-2-3-1": [
    {x:50,y:88,label:"שוער"},
    {x:20,y:72,label:"מגן ימני"}, {x:40,y:74,label:"בלם"}, {x:60,y:74,label:"בלם"}, {x:80,y:72,label:"מגן שמאלי"},
    {x:40,y:58,label:"קשר אחורי"}, {x:60,y:58,label:"קשר אחורי"},
    {x:25,y:40,label:"קיצוני ימין"}, {x:50,y:42,label:"קשר התקפי"}, {x:75,y:40,label:"קיצוני שמאל"},
    {x:50,y:26,label:"חלוץ"}
  ],
  "3-5-2": [
    {x:50,y:88,label:"שוער"},
    {x:35,y:74,label:"בלם"}, {x:50,y:76,label:"בלם"}, {x:65,y:74,label:"בלם"},
    {x:18,y:52,label:"ווינגבק ימין"}, {x:40,y:58,label:"קשר מרכזי"}, {x:50,y:56,label:"קשר מרכזי"}, {x:60,y:58,label:"קשר מרכזי"}, {x:82,y:52,label:"ווינגבק שמאל"},
    {x:44,y:28,label:"חלוץ"}, {x:56,y:28,label:"חלוץ"}
  ]
};

function openMaccabiLineup(){
  const home = homeNameEl.textContent.trim();
  const away = awayNameEl.textContent.trim();

  if(home === "מכבי תל אביב") maccabiSide = "home";
  else if(away === "מכבי תל אביב") maccabiSide = "away";
  else return;

  lineupSideTag.textContent = "צד: " + (maccabiSide==="home" ? "בית" : "חוץ");
  showFormationScreen();
  lineupDialog.showModal();
}

function showFormationScreen(){
  formationScreen.style.display = "block";
  editorScreen.style.display = "none";
}

function chooseFormation(f){
  currentFormation = f;
  formationScreen.style.display = "none";
  editorScreen.style.display = "block";
  buildEditor();
}

/* ---- Drag system for Mouse + Touch (Pointer Events) ---- */
let dragState = null; // {name, fromIndex, ghost, pointerId}

function createGhost(text, x, y){
  const g = document.createElement("div");
  g.className = "dragGhost";
  g.textContent = text;
  g.style.left = x + "px";
  g.style.top  = y + "px";
  document.body.appendChild(g);
  return g;
}

function startDrag(name, pointerId, x, y, fromIndex=null){
  if(dragState?.ghost) dragState.ghost.remove();
  const ghost = createGhost(name, x, y);
  dragState = { name, fromIndex, ghost, pointerId };
}

function moveDrag(x, y){
  if(!dragState) return;
  dragState.ghost.style.left = x + "px";
  dragState.ghost.style.top  = y + "px";
}

function endDrag(x, y){
  if(!dragState) return;

  const el = document.elementFromPoint(x, y);
  const spot = el?.classList?.contains("spot") ? el : el?.closest?.(".spot");

  if(spot){
    if(typeof dragState.fromIndex === "number"){
      const from = miniPitch.querySelector(`.spot[data-index="${dragState.fromIndex}"]`);
      if(from){
        delete from.dataset.playerName;
        from.textContent = from.dataset.label;
      }
    }
    spot.dataset.playerName = dragState.name;
    spot.textContent = dragState.name;
  }

  dragState.ghost.remove();
  dragState = null;
}

function attachPointerDrag(el, getNameFn, getFromIndexFn){
  el.addEventListener("pointerdown", (e)=>{
    const name = getNameFn();
    if(!name) return;
    e.preventDefault();
    el.setPointerCapture(e.pointerId);
    startDrag(name, e.pointerId, e.clientX, e.clientY, getFromIndexFn ? getFromIndexFn() : null);
  });

  el.addEventListener("pointermove", (e)=>{
    if(dragState?.pointerId !== e.pointerId) return;
    moveDrag(e.clientX, e.clientY);
  });

  el.addEventListener("pointerup", (e)=>{
    if(dragState?.pointerId !== e.pointerId) return;
    endDrag(e.clientX, e.clientY);
  });

  el.addEventListener("pointercancel", (e)=>{
    if(dragState?.pointerId !== e.pointerId) return;
    endDrag(e.clientX, e.clientY);
  });
}

function buildEditor(){
  // Bench players
  benchPlayers.innerHTML = "";
  maccabiPlayers.forEach(pl=>{
    const p = document.createElement("div");
    p.className = "player";
    p.textContent = `${pl.pos} - ${pl.name}`;
    attachPointerDrag(p, ()=>pl.name, null);
    benchPlayers.appendChild(p);
  });

  // Pitch spots
  miniPitch.innerHTML = "";
  const spots = formations[currentFormation] || [];
  spots.forEach((s, idx)=>{
    const spot = document.createElement("div");
    spot.className = "spot";
    spot.style.left = s.x + "%";
    spot.style.top  = s.y + "%";
    spot.dataset.index = String(idx);
    spot.dataset.label = s.label;
    spot.textContent = s.label;

    attachPointerDrag(
      spot,
      ()=>spot.dataset.playerName || null,
      ()=>idx
    );

    miniPitch.appendChild(spot);
  });
}

function resetLineup(){
  const spots = miniPitch.querySelectorAll(".spot");
  spots.forEach(s=>{
    delete s.dataset.playerName;
    s.textContent = s.dataset.label;
  });
}

/* ================== Service Worker ================== */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}

/* בדיקה ראשונית לכפתור מכבי */
updateMaccabiButton();
</script>

</body>
</html>
